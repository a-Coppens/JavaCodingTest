name: ci/cd

on:
  #push:
    #branches:
    #- 'master' # When a push event occurs on master this workflow runs
    
    # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:
jobs:
  docker:
    runs-on: ubuntu-latest

    steps:
       -
        name: Checkout
        uses: actions/checkout@v2
        
       - name: setup Java Environment
       - uses: actions/setup-java@v2
         with:
           java-version: '11'
           distribution: 'adopt'
           
       - name: Build Snapshots run Tests
         run: mvn --batch-mode --update-snapshots verify
         
       - name: Build Docker push ECR
       - uses: vitr/actions-build-and-upload-to-ecs@master
         with:
            access_key_id: ${{ secrets.AWS_ACCESS_KEY_ID }}
            secret_access_key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
            account_id: ${{ secrets.AWS_ACCOUNT_ID }}
            repo: docker/repo
            region: ap-southeast-1
            tags: latest,${{ github.sha }}
            create_repo: true
            
       - name: Run a multi-line script
         run: |
          ls -la
          cd ./CodingTest-CDK/bin
          ls -la

